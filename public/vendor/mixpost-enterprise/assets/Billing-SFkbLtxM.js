import{i as C,A as T,x as j,B as V,o as q,c as l,a as r,u as t,b as h,p as d,d as n,C as D,q as u,F as b,e as O,f as a,Z as z,g as c,t as o,m as _,v as $,s as I,D as U,E as W,z as k}from"./app-ByuBUqrL.js";import{u as A}from"./useSubscription-DBHFeTfH.js";import{_ as M}from"./Workspace-Bqe3NjqN.js";import{_ as y}from"./Panel-BpEjWyUt.js";import{_ as v}from"./SubscriptionStatusBadge-BeL7EpCj.js";import{_ as S}from"./Flex-DzNCiE-H.js";import{_ as R,a as N,b as Z}from"./SubscriptionEnds-DGtVlcmE.js";import{_ as G}from"./PageHeader-CN-6eb5e.js";import"./Subscription-CbfMHFMF.js";import"./ArrowLeft-DJ_W9Jbv.js";import"./ListItem-DD71nSmU.js";const H=()=>{const{notify:s}=T(),e=C("authPasswordConfirmation");return{onError:(p,w=null)=>{if(p.confirm_password){e().onConfirm(w).show();return}s("error",p)}}},J={class:"w-full"},K={key:0},Q={key:1},X={class:"text-lg font-semibold"},Y={key:2},ee={key:3,class:"mt-lg"},se=O({layout:M}),fe=Object.assign(se,{__name:"Billing",props:{workspace:{required:!0,type:Object},subscription:{required:!0,type:[Object,null]},currency:{type:String,default:"USD"},has_delay:{type:Boolean,default:!1},free_plan_exists:{type:Boolean,default:!1}},setup(s){const{t:e}=j(),m=C("routePrefix"),p=C("confirmation"),{canCancel:w,isCanceled:x}=A(),{onError:g}=H(),P=s,{activeWorkspaceId:f}=V(),B=()=>{p().title(e("subscription.cancel_sub")).description(e("subscription.confirm_cancel_sub")).destructive().btnCancelName(e("general.dismiss")).btnConfirmName(e("subscription.cancel_sub")).onConfirm(i=>{i.isLoading(!0),k.post(route(`${m}.workspace.subscription.cancel`,{workspace:f.value}),{},{preserveState:!0,onSuccess(){i.reset()},onFinish(){i.isLoading(!1)},onError:g})}).show()},F=()=>{p().title(e("subscription.downgrade_free_plan")).description(e("subscription.confirm_downgrade_free_plan")+`

`+e("subscription.features_access_lost")).btnCancelName(e("general.dismiss")).btnConfirmName(e("subscription.downgrade")).onConfirm(i=>{i.isLoading(!0),k.post(route(`${m}.workspace.subscription.downgradeToFreePlan`,{workspace:f.value}),{},{preserveState:!0,onSuccess(){i.reset()},onFinish(){i.isLoading(!1)},onError:g})}).show()},L=()=>{p().title(e("subscription.resume")).description(e("subscription.confirm_resume")).btnCancelName(e("general.dismiss")).btnConfirmName(e("subscription.resume")).onConfirm(i=>{i.isLoading(!0),k.post(route(`${m}.workspace.subscription.resume`,{workspace:f.value}),{},{preserveState:!0,onSuccess(){i.reset()},onFinish(){i.isLoading(!1)},onError:g})}).show()},E=()=>{k.put(route(`${m}.workspace.portalPaymentPlatform`,{workspace:f.value}))};return q(()=>{P.has_delay&&setTimeout(()=>{const i=window.location.href;window.location.href=i.split("?")[0]},7e3)}),(i,te)=>(a(),l(b,null,[r(t(z),{title:t(e)("general.billing")},null,8,["title"]),h("div",J,[r(G,{title:t(e)("general.billing"),"with-padding-x":!1},null,8,["title"]),s.has_delay?(a(),d(D,{key:0},{default:n(()=>[c(o(t(e)("dashboard.processing")),1)]),_:1})):u("",!0),r(y,null,{title:n(()=>[c(o(t(e)("subscription.current_sub_plan")),1)]),default:n(()=>[s.subscription?(a(),l(b,{key:0},[r(R,{subscription:s.subscription,currency:s.currency},null,8,["subscription","currency"]),r(v,{status:s.subscription.status,class:"mt-xs"},null,8,["status"]),r(N,{subscription:s.subscription},null,8,["subscription"]),r(S,{class:"mt-lg"},{default:n(()=>[i.$page.props.can_be_resumed?(a(),d(_,{key:0,onClick:L},{default:n(()=>[c(o(t(e)("subscription.resume")),1)]),_:1})):(a(),d(t($),{key:1,href:i.route(`${t(m)}.workspace.upgrade`,{workspace:s.workspace.uuid})},{default:n(()=>[r(_,null,{default:n(()=>[t(x)(s.subscription.status)?(a(),l("span",K,o(t(e)("subscription.resume")),1)):(a(),l("span",Q,o(t(e)("subscription.change_sub_plan")),1))]),_:1})]),_:1},8,["href"]))]),_:1})],64)):u("",!0),s.workspace.generic_subscription?(a(),l(b,{key:1},[h("p",X,o(s.workspace.generic_subscription.name),1),!s.workspace.generic_subscription.free&&s.workspace.generic_subscription.trial_ends_at?(a(),l(b,{key:0},[r(v,{status:"trialing"}),r(N,{subscription:{status:"trialing",trial_ends_at:s.workspace.generic_subscription.trial_ends_at}},null,8,["subscription"])],64)):u("",!0)],64)):u("",!0),!s.subscription&&!s.workspace.generic_subscription?(a(),l("p",Y,o(t(e)("subscription.no_active_sub")),1)):u("",!0),s.subscription?u("",!0):(a(),l("div",ee,[r(t($),{href:i.route(`${t(m)}.workspace.upgrade`,{workspace:s.workspace.uuid})},{default:n(()=>[r(_,null,{default:n(()=>[c(o(t(e)("general.subscribe")),1)]),_:1})]),_:1},8,["href"])])),s.free_plan_exists&&(s.subscription||s.workspace.generic_subscription&&!s.workspace.generic_subscription.free)?(a(),d(S,{key:4},{default:n(()=>[h("div",{onClick:F,class:"mt-lg"},[r(I,null,{default:n(()=>[c(o(t(e)("subscription.downgrade_free_plan")),1)]),_:1})])]),_:1})):u("",!0)]),_:1}),s.subscription?(a(),d(y,{key:1,class:"mt-lg"},{title:n(()=>[c(o(t(e)("dashboard.payment_method")),1)]),default:n(()=>[r(Z,{payment_method:s.workspace.payment_method},null,8,["payment_method"]),r(_,{onClick:E,class:U(s.workspace.payment_method.type?"mt-lg":"")},{default:n(()=>[c(o(t(e)("dashboard.update_payment_method")),1)]),_:1},8,["class"])]),_:1})):u("",!0),s.subscription&&t(w)(s.subscription.status)?(a(),d(y,{key:2,class:"mt-lg"},{title:n(()=>[c(o(t(e)("subscription.cancel_sub")),1)]),description:n(()=>[c(o(t(e)("subscription.can_cancel_sub")),1)]),default:n(()=>[r(W,{onClick:B,class:"btn-primary danger in-form"},{default:n(()=>[c(o(t(e)("subscription.cancel_sub")),1)]),_:1})]),_:1})):u("",!0)])],64))}});export{fe as default};
