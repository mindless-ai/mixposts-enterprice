import{r as P,y as L,cA as z,f as u,c as h,a,d as l,P as D,g,t as s,s as j,b as r,j as U,p as v,F as w,K as E,q as V,_ as G,h as b,x as I,i as A,T as K,l as F,u as e,m as M,Z,k as C,A as H}from"./app-ByuBUqrL.js";import{u as J}from"./usePageMode-CYQMu83q.js";import{_ as Q}from"./PageHeader-CN-6eb5e.js";import{_ as q}from"./Panel-BpEjWyUt.js";import{L as W,_ as X}from"./ListItem-DD71nSmU.js";import{_ as O}from"./NoResult-DcalDTDJ.js";import{O as Y,_ as ee,S as le,a as te}from"./Actions-BKdTTCEh.js";import{_ as N}from"./Select-B7eUkNrn.js";import{_ as ae}from"./InputLength-DG5q3XMn.js";import"./Flex-DzNCiE-H.js";import"./Trash-Ep8Ewxdj.js";import"./Eye-BezOvdnp.js";const re={class:"mt-xs"},se={class:"text-sm"},oe={key:0},ne={key:1},ie={__name:"AddPlanLimit",props:{items:{type:Array,required:!0},addedResources:{type:Array,default:[]}},emits:["select"],setup(p){const o=p,m=P(!1);P(null);const $=P(""),n=L(()=>o.items.filter(i=>{const t=z(i.name).toLocaleLowerCase().includes($.value.toLocaleLowerCase());return!o.addedResources.includes(i.code)&&t})),f=()=>{m.value=!0},x=()=>{m.value=!1};return(i,t)=>(u(),h(w,null,[a(j,{onClick:f,size:"sm"},{icon:l(()=>[a(D)]),default:l(()=>[g(" "+s(i.$t("plan.add_limit")),1)]),_:1}),a(G,{show:m.value,"max-width":"lg","scrollable-body":!0,closeable:!0,onClose:x},{header:l(()=>[g(s(i.$t("plan.feature_limit")),1)]),body:l(()=>[r("div",re,[a(U,{modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=y=>$.value=y),type:"text",autofocus:"",placeholder:i.$t("plan.search_plan"),class:"w-full"},null,8,["modelValue","placeholder"])]),n.value.length?(u(),v(W,{key:0,class:"mt-xs"},{default:l(()=>[(u(!0),h(w,null,E(n.value,y=>(u(),v(X,{onClick:S=>i.$emit("select",{code:y.code,form:y.form.map(k=>({name:k.name,value:k.value}))}),tabindex:"0",role:"button"},{default:l(()=>[r("div",null,s(y.name),1),r("div",se,s(y.description),1)]),_:2},1032,["onClick"]))),256))]),_:1})):V("",!0),n.value.length?V("",!0):(u(),v(O,{key:1,class:"mt-md"},{default:l(()=>[$.value?(u(),h("span",oe,s(i.$t("plan.no_feature_limit")),1)):(u(),h("span",ne,s(i.$t("plan.limits_reached")),1))]),_:1}))]),footer:l(()=>[a(j,{onClick:x},{default:l(()=>[g(s(i.$t("general.done")),1)]),_:1})]),_:1},8,["show"])],64))}},ue={class:"capitalize"},de={class:"flex items-center gap-2xl mb-lg last:mb-0"},ce=["for"],me=["for"],pe={__name:"PlanPriceEditor",props:{price:{type:Object,default:{}},errors:{type:Object,default:{}}},setup(p){const o=["monthly","yearly"];return(m,$)=>(u(),v(q,null,{title:l(()=>[g(s(m.$t("finance.price_info")),1)]),default:l(()=>[(u(),h(w,null,E(o,n=>a(Y,null,{title:l(()=>[r("span",ue,s(m.$t(`subscription.${n}`)),1)]),default:l(()=>[r("div",de,[a(b,null,{title:l(()=>[r("label",{for:`price-${n}`},s(m.$t("finance.amount"))+" ("+s(m.$page.props.currency)+")",9,ce)]),default:l(()=>[a(ae,{modelValue:p.price[n].amount,"onUpdate:modelValue":f=>p.price[n].amount=f,id:`price-${n}`,error:p.errors[`price.${n}.amount`],class:"w-full",required:""},null,8,["modelValue","onUpdate:modelValue","id","error"])]),_:2},1024),a(b,null,{title:l(()=>[r("label",{for:`platform_plan_id-${n}`},s(m.$t("plan.plan_id")),9,me)]),default:l(()=>[a(U,{modelValue:p.price[n].platform_plan_id,"onUpdate:modelValue":f=>p.price[n].platform_plan_id=f,id:`platform_plan_id-${n}`,type:"text",error:p.errors[`price.${n}.platform_plan_id`],class:"w-full",required:""},null,8,["modelValue","onUpdate:modelValue","id","error"])]),_:2},1024)])]),_:2},1024)),64))]),_:1}))}},_e={class:"flex flex-col grow h-full overflow-y-auto"},fe={class:"flex flex-row h-full overflow-y-auto"},$e={class:"w-full mx-auto row-py"},ge={class:"mt-lg row-px w-full"},ye={class:"w-full max-w-lg"},ve={for:"name"},he={for:"type"},be={value:"free"},xe={value:"paid"},Ve={for:"text"},we={value:1},ke={value:0},Ce={for:"text"},Le={class:"flex items-center"},Ue={class:"w-full"},Pe={class:"flex flex-col gap-md w-full"},qe={class:"w-full flex items-center justify-end bg-stone-500 border-t border-gray-200 z-10 mt-0.5"},Ee={class:"w-full py-md flex items-center space-x-xs row-px"},Ie={__name:"CreateEdit",props:{feature_limit_resources:{type:Array,required:!0},plan:{type:Object,required:!1}},setup(p){const{t:o}=I(),m=A("routePrefix");A("confirmation");const{isCreate:$,isEdit:n}=J(),{notify:f}=H(),x=L(()=>$.value?o("plan.create_plan"):o("plan.edit_plan")),i=p,t=K(i.plan?F.cloneDeep(i.plan):{name:"",type:"free",trial_days:7,enabled:1,sort_order:0,price:{monthly:{amount:0,platform_plan_id:""},yearly:{amount:0,platform_plan_id:""}},limits:[]}),y=L(()=>t.type==="free"),S=L(()=>t.limits.map(_=>{const d=F.find(i.feature_limit_resources,{code:_.code});return d?{resource:d,featureLimit:_}:null}).filter(_=>_!==null)),k=_=>{t.limits.push(_)},R=_=>{t.limits=t.limits.filter(d=>d.code!==_)},B=()=>{if($.value){t.post(route(`${m}.plans.store`),{onSuccess(){f("success",o("plan.plan_created"))},onError(){f("error",o("plan.plan_not_created"))}});return}t.put(route(`${m}.plans.update`,{plan:i.plan.id}),{onSuccess(){f("success",o("plan.plan_updated"))},onError(_){f("error",o("plan.plan_not_updated"))}})};return(_,d)=>(u(),h(w,null,[a(e(Z),{title:x.value},null,8,["title"]),r("div",_e,[r("div",fe,[r("div",$e,[a(Q,{title:x.value},{description:l(()=>[g(s(e(n)?e(t).name:""),1)]),default:l(()=>[e(n)?(u(),v(ee,{key:0,plan:p.plan,edit:!1},null,8,["plan"])):V("",!0)]),_:1},8,["title"]),r("div",ge,[a(q,null,{title:l(()=>[g(s(e(o)("general.details")),1)]),default:l(()=>[r("div",ye,[a(b,null,{title:l(()=>[r("label",ve,s(e(o)("general.name")),1)]),footer:l(()=>[a(C,{message:e(t).errors.name},null,8,["message"])]),default:l(()=>[a(U,{modelValue:e(t).name,"onUpdate:modelValue":d[0]||(d[0]=c=>e(t).name=c),error:e(t).errors.name,type:"text",id:"name",autofocus:"",class:"w-full",required:""},null,8,["modelValue","error"])]),_:1}),a(b,{class:"mt-lg"},{title:l(()=>[r("label",he,s(e(o)("general.type")),1)]),footer:l(()=>[a(C,{message:e(t).errors.type},null,8,["message"])]),default:l(()=>[a(N,{modelValue:e(t).type,"onUpdate:modelValue":d[1]||(d[1]=c=>e(t).type=c),disabled:e(n),error:e(t).errors.type},{default:l(()=>[r("option",be,s(e(o)("general.free")),1),r("option",xe,s(e(o)("general.paid")),1)]),_:1},8,["modelValue","disabled","error"])]),_:1}),a(b,{class:"mt-lg"},{title:l(()=>[r("label",Ve,s(e(o)("general.status")),1)]),footer:l(()=>[a(C,{message:e(t).errors.enabled},null,8,["message"])]),default:l(()=>[a(N,{modelValue:e(t).enabled,"onUpdate:modelValue":d[2]||(d[2]=c=>e(t).enabled=c),error:e(t).errors.text},{default:l(()=>[r("option",we,s(e(o)("general.enabled")),1),r("option",ke,s(e(o)("general.disabled")),1)]),_:1},8,["modelValue","error"])]),_:1}),a(b,{class:"mt-lg"},{title:l(()=>[r("label",Ce,s(e(o)("general.sort_order")),1)]),footer:l(()=>[a(C,{message:e(t).errors.sort_order},null,8,["message"])]),default:l(()=>[a(U,{type:"number",modelValue:e(t).sort_order,"onUpdate:modelValue":d[3]||(d[3]=c=>e(t).sort_order=c)},null,8,["modelValue"])]),_:1})])]),_:1}),y.value?V("",!0):(u(),v(pe,{key:0,price:e(t).price,errors:e(t).errors,class:"mt-lg"},null,8,["price","errors"])),a(q,{class:"mt-lg"},{title:l(()=>[r("div",Le,[a(le,{class:"mr-xs"}),g(" "+s(e(o)("plan.limits")),1)])]),description:l(()=>[g(s(e(o)("plan.access_all_features")),1)]),action:l(()=>[a(ie,{items:_.$page.props.feature_limit_resources,addedResources:e(t).limits.map(c=>c.code),onSelect:k},null,8,["items","addedResources"])]),default:l(()=>[r("div",Ue,[r("div",Pe,[(u(!0),h(w,null,E(S.value,(c,T)=>(u(),v(te,{key:`${c.resource.code}-${T}`,resource:c.resource,form:c.featureLimit.form,onRemove:R},null,8,["resource","form"]))),128)),e(t).limits.length?V("",!0):(u(),v(O,{key:0}))])])]),_:1})])])]),r("div",qe,[r("div",Ee,[a(M,{onClick:B,disabled:e(t).processing,isLoading:e(t).processing},{default:l(()=>[g(s(e($)?e(o)("general.create"):e(o)("workspace.update")),1)]),_:1},8,["disabled","isLoading"])])])])],64))}};export{Ie as default};
