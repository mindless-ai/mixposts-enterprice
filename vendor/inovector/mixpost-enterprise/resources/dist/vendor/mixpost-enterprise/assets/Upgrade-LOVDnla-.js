import{G as O,f as l,c as d,b as v,x as U,i as z,T as H,r as y,B as R,y as W,o as G,Y as K,$ as Y,a as i,u as t,d as a,p as h,q as u,m as Z,_ as J,F as S,e as Q,Z as X,g as p,t as c,K as ee,j as se,h as te,s as ae,a0 as ne,z as re,a1 as oe,k as ie,C as le,A as ce}from"./app-ByuBUqrL.js";import{u as B}from"./useSubscription-DBHFeTfH.js";import{_ as ue}from"./Workspace-Bqe3NjqN.js";import{_ as E}from"./Panel-BpEjWyUt.js";import{_ as pe}from"./Plans-BCDXB3G4.js";import{_ as de}from"./PureButtonLink-ehuUqjIX.js";import{A as me}from"./ArrowLeft-DJ_W9Jbv.js";import"./Subscription-CbfMHFMF.js";import"./VerticalGroup-KNmuiiE8.js";import"./Flex-DzNCiE-H.js";import"./Radio-CErsXVSv.js";const fe={},_e={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"};function ge(o,s){return l(),d("svg",_e,s[0]||(s[0]=[v("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"},null,-1)]))}const be=O(fe,[["render",ge]]),ye={class:"w-full mx-auto"},he={key:0,class:"link-primary"},ve={key:1,class:"link-primary"},we=Q({layout:ue}),je=Object.assign(we,{__name:"Upgrade",props:{workspace:{type:Object,required:!0},subscription:{type:[Object,null],required:!0},billing_configs:{type:Object,required:!0},plans:{type:Array,required:!0},payment_support_trialing:{type:Boolean,required:!0},payment_support_coupon:{type:Boolean,required:!0}},setup(o){const{t:s}=U(),m=z("routePrefix"),n=o,r=H({cycle:"monthly",plan_id:null,coupon:""}),C=y(null),{activeWorkspaceId:f}=R(),{notify:w}=ce(),j=e=>{r.cycle=e.cycle,r.plan_id=e.plan_id},q=()=>!n.billing_configs.generic_trial&&!n.payment_support_trialing||n.subscription||n.workspace.generic_subscription&&n.workspace.generic_subscription.has_trial?0:parseInt(n.billing_configs.trial_days),{isCanceled:_}=B(),V=W(()=>{const e=q();return e?s("subscription.start_trial",{days:e}):n.subscription&&!_(n.subscription.status)?s("subscription.change_plan"):s("general.subscribe")}),g=y(!1),b=y(!1),k=y(!1),T=()=>{k.value=!0},$=()=>{k.value=!1},L=()=>{$()};G(()=>{document.addEventListener("closePaymentDetailsModal",L)}),K(()=>{document.removeEventListener("closePaymentDetailsModal",L)});const M=Y([]),A=()=>{g.value=!0,M.value.forEach(e=>{e.remove()}),axios.post(route(`${m}.workspace.subscription.new`,{workspace:f.value}),r.data()).then(e=>{if(e.data.redirect_to){window.location.href=e.data.redirect_to;return}b.value=!0,T(),setTimeout(()=>{M.value=ne(e.data),C.value.innerHTML=e.data,b.value=!1},1e3)}).finally(()=>{g.value=!1}).catch(e=>{if(b.value=!1,e.response.status===409){w("success",e.response.data.message),re.visit(route(`${m}.workspace.billing`,{workspace:f.value}));return}e.response.status===422&&r.setError("error",oe(e.response.data.errors)),w("error",s("error.something_wrong"))})},F=()=>{r.post(route(`${m}.workspace.subscription.changePlan`,{workspace:f.value}),{preserveScroll:!0,onError(){w("error",s("error.something_wrong"))}})},{canChangePlan:I}=B(),N=()=>{r.clearErrors(),n.subscription&&I(n.subscription.status)?F():A()},P=()=>n.subscription&&!_(n.subscription.status)?s("subscription.change_sub_plan"):s("general.subscribe");return(e,D)=>(l(),d(S,null,[i(t(X),{title:P()},null,8,["title"]),v("div",ye,[i(E,null,{title:a(()=>[p(c(P()),1)]),default:a(()=>[i(pe,{currentPlan:o.subscription?o.subscription.plan:null,billingConfigs:o.billing_configs,plans:o.plans,onChange:j},null,8,["currentPlan","billingConfigs","plans"]),v("div",null,[(l(!0),d(S,null,ee(t(r).errors,x=>(l(),h(ie,{message:x,class:"mt-lg"},null,8,["message"]))),256))])]),_:1}),o.payment_support_coupon?(l(),h(E,{key:0,class:"mt-lg"},{title:a(()=>[p(c(t(s)("subscription.use_coupon")),1)]),default:a(()=>[i(te,null,{default:a(()=>[i(se,{modelValue:t(r).coupon,"onUpdate:modelValue":D[0]||(D[0]=x=>t(r).coupon=x),name:"coupon",type:"text",placeholder:t(s)("subscription.insert_coupon")},null,8,["modelValue","placeholder"])]),_:1})]),_:1})):u("",!0),o.subscription?(l(),h(de,{key:1,href:e.route(`${t(m)}.workspace.billing`,{workspace:t(f)}),class:"mt-lg mr-md"},{icon:a(()=>[i(me)]),default:a(()=>[t(_)(o.subscription.status)?u("",!0):(l(),d("span",he,c(t(s)("plan.keep_old_plan")),1)),t(_)(o.subscription.status)?(l(),d("span",ve,c(t(s)("dashboard.back_billing")),1)):u("",!0)]),_:1},8,["href"])):u("",!0),i(Z,{onClick:N,disabled:g.value||t(r).processing,isLoading:g.value||t(r).processing,size:"sm",class:"mt-lg"},{icon:a(()=>[i(be)]),default:a(()=>[p(" "+c(V.value),1)]),_:1},8,["disabled","isLoading"])]),i(J,{show:k.value,"max-width":"sm",closeable:!1,onClose:$},{header:a(()=>[p(c(t(s)("dashboard.payment_details")),1)]),body:a(()=>[b.value?(l(),h(le,{key:0,rounded:!0})):u("",!0),v("div",{ref_key:"paymentMethod",ref:C,class:"mt-1"},null,512)]),footer:a(()=>[i(ae,{onClick:$},{default:a(()=>[p(c(t(s)("general.cancel")),1)]),_:1})]),_:1},8,["show"])],64))}});export{je as default};
